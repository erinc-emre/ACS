# Repository Commits XML Schema Documentation

## Overview

The `repository-commits.xsd` schema defines the structure for XML files generated by the `export-logs.sh` script. This schema validates Git repository commit data exported in a structured XML format.

## Schema Structure

### Root Element: `<repository>`
The root element contains all information about a single Git repository and its commits.

```xml
<repository>
    <name>repository-name</name>
    <url>https://github.com/owner/repo.git</url>
    <commits>
        <!-- commit elements here -->
    </commits>
</repository>
```

### Elements Description

#### `<name>` (string)
- **Purpose**: Repository name, typically derived from the Git URL basename
- **Example**: `carbon-lang` (from `carbon-language/carbon-lang.git`)
- **Constraints**: Standard string, no specific format restrictions

#### `<url>` (anyURI)
- **Purpose**: Complete Git repository URL
- **Example**: `https://github.com/carbon-language/carbon-lang.git`
- **Constraints**: Must be a valid URI format

#### `<commits>` (container)
- **Purpose**: Container element for all commit entries
- **Children**: Zero or more `<commit>` elements
- **Constraints**: Can be empty if no commits are found

#### `<commit>` (CommitType)
Contains detailed information about a single Git commit:

##### `<hash>` (GitHashType)
- **Purpose**: Git commit SHA-1 hash
- **Format**: Exactly 40 hexadecimal characters
- **Example**: `a1b2c3d4e5f6789012345678901234567890abcd`
- **Validation**: Pattern `[a-fA-F0-9]{40}` with length exactly 40

##### `<author>` (EmailType)
- **Purpose**: Email address of the commit author
- **Example**: `developer@example.com`
- **Validation**: Basic email pattern `[^@]+@[^@]+\.[^@]+`
- **Constraints**: Length between 3-320 characters

##### `<date>` (IsoDateTimeType)
- **Purpose**: Commit timestamp in ISO format with timezone
- **Format**: `YYYY-MM-DD HH:MM:SS +/-HHMM`
- **Example**: `2025-06-28 14:30:45 +0200`
- **Source**: Generated by `git log --date=iso`

##### `<message>` (string)
- **Purpose**: Complete commit message (subject + body)
- **Format**: Wrapped in `<![CDATA[...]]>` to preserve formatting
- **Content**: Full commit message including line breaks and special characters
- **Note**: May contain multiple lines, special characters, and markup

## Custom Types

### GitHashType
- **Base**: `xs:string`
- **Pattern**: `[a-fA-F0-9]{40}`
- **Length**: Exactly 40 characters
- **Purpose**: Ensures valid Git SHA-1 hash format

### EmailType
- **Base**: `xs:string`
- **Pattern**: `[^@]+@[^@]+\.[^@]+`
- **Length**: 3-320 characters
- **Purpose**: Basic email address validation

### IsoDateTimeType
- **Base**: `xs:string`
- **Pattern**: `\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2} [+-]\d{4}`
- **Purpose**: Validates ISO datetime format with timezone as produced by Git

## Usage

### Validation
Use the provided validation script:
```bash
./validate-xml.sh
```

Or validate manually with xmllint:
```bash
xmllint --noout --schema repository-commits.xsd XML_commit_messages/repo_commits.xml
```

### Integration
The schema can be referenced in XML files with:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<repository xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:noNamespaceSchemaLocation="repository-commits.xsd">
    <!-- content -->
</repository>
```

## Example Valid XML

```xml
<?xml version="1.0" encoding="UTF-8"?>
<repository>
    <name>carbon-lang</name>
    <url>https://github.com/carbon-language/carbon-lang.git</url>
    <commits>
        <commit>
            <hash>a1b2c3d4e5f6789012345678901234567890abcd</hash>
            <author>developer@example.com</author>
            <date>2025-06-28 14:30:45 +0200</date>
            <message><![CDATA[Fix parsing issue in lexer

This commit addresses a bug where the lexer would incorrectly
handle escaped characters in string literals.

Fixes #123]]></message>
        </commit>
    </commits>
</repository>
```

## Files

- `repository-commits.xsd` - The XML Schema Definition
- `validate-xml.sh` - Validation script for generated XML files
- `export-logs.sh` - Git commit export script that generates XML
- `README-schema.md` - This documentation file
